    
{% extends 'urunler/base.html' %}

{% block title %}Ana Sayfa | KOLAY BUL EKSPRES{% endblock %}

{% block content %}
<div class="container" style="padding: 0 8px;">
    
    
    <!-- Biz Ne YapÄ±yoruz Butonu -->
    <div style="padding: 0 8px; margin-bottom: 20px;">
        <button id="toggleAboutBtn" style="width: auto; max-width: 400px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #fff; border: none; border-radius: 6px; padding: 6px 10px; font-size: 0.75em; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 6px rgba(245, 158, 11, 0.2);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 3px 10px rgba(245, 158, 11, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 6px rgba(245, 158, 11, 0.2)'">
            ğŸ¯ Sitemiz Ne Ä°ÅŸe YarÄ±yor Bizim KarÄ±mÄ±z Nedir?  <span id="toggleIcon" style="float:right; font-size:0.9em; transition: transform 0.3s; margin-left: 4px;">â–¼</span>
        </button>
    </div>
    
    <!-- AÃ§Ä±klayÄ±cÄ± Kart ve HakkÄ±mÄ±zda (BaÅŸlangÄ±Ã§ta Gizli) -->
    <div id="aboutSection" style="display: none; animation: slideDown 0.3s ease-out;">
        <!-- AÃ§Ä±klayÄ±cÄ± Kart -->
        <div style="max-width: 700px; margin: 0 auto 20px auto; padding: 16px; background: linear-gradient(135deg, #f0f4ff 0%, #fff5f7 100%); border-radius: 12px; border-left: 4px solid #6366f1; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);">
            <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 1.5em;">ğŸ”</div>
                <div>
                    <h2 style="margin: 0 0 8px 0; color: #1f2937; font-size: 1em; font-weight: 700;">AliExpress ÃœrÃ¼nlerini HÄ±zlÄ± Bulun</h2>
                    <p style="margin: 0 0 8px 0; color: #4b5563; font-size: 0.95em; line-height: 1.5;">Milyonlarca Ã¼rÃ¼n iÃ§inden aradÄ±ÄŸÄ±nÄ±zÄ± saniyeler iÃ§inde keÅŸfedin. PopÃ¼ler Ã¼rÃ¼nler, en ucuz seÃ§enekler ve en Ã§ok satanlarÄ± gÃ¶rmek kolay.</p>
                </div>
            </div>
            
            <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 1.5em;">ğŸ’µ</div>
                <div>
                    <h2 style="margin: 0 0 8px 0; color: #1f2937; font-size: 1em; font-weight: 700;">GerÃ§ek FiyatlarÄ± GÃ¶rerek Karar Verin</h2>
                    <p style="margin: 0 0 8px 0; color: #4b5563; font-size: 0.95em; line-height: 1.5;">Her Ã¼rÃ¼n iÃ§in net fiyatÄ± (Ã¼rÃ¼n fiyatÄ± + kargo Ã¼creti) gÃ¶rÃ¼n. Hangi deposundan gÃ¶nderileceÄŸini Ã¶nceden bilin. Ã–rnek: Avrupa deposundan Ã§ok daha hÄ±zlÄ± gelir!</p>
                </div>
            </div>
            
            <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 1.5em;">ğŸšš</div>
                <div>
                    <h2 style="margin: 0 0 8px 0; color: #1f2937; font-size: 1em; font-weight: 700;">Kargo Ãœcretini Ã–nceden Bilin</h2>
                    <p style="margin: 0 0 8px 0; color: #4b5563; font-size: 0.95em; line-height: 1.5;">GÃ¶nderildiÄŸi yerden haberdar olursunuz. Avrupa deposundan gelirse 7-15 gÃ¼n(TÃ¼rkiye gÃ¶nderimli Ã¼rÃ¼nlerle aynÄ± sÃ¼re), Ã‡in'den gelirse 20-40 gÃ¼n arasÄ± beklemeyi Ã¶ngÃ¶rÃ¼n.</p>
                </div>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <div style="font-size: 1.5em;">âš¡</div>
                <div>
                    <h2 style="margin: 0 0 8px 0; color: #1f2937; font-size: 1em; font-weight: 700;">Tek TÄ±kla SatÄ±n AlÄ±n</h2>
                    <p style="margin: 0; color: #4b5563; font-size: 0.95em; line-height: 1.5;">BeÄŸendiÄŸiniz Ã¼rÃ¼ne tÄ±klayÄ±n ve doÄŸrudan AliExpress'e yÃ¶nlenin. GÃ¼venli Ã¶deme ve satÄ±cÄ± garantisi AliExpress tarafÄ±ndan saÄŸlanÄ±r.</p>
                </div>
            </div>
        </div>
        
        <!-- HakkÄ±mÄ±zda BÃ¶lÃ¼mÃ¼ -->
        <div style="max-width: 700px; margin: 0 auto 20px auto; padding: 16px; background: #fff9e6; border-radius: 12px; border-left: 4px solid #f59e0b; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);">
            <h2 style="text-align: center; color: #d97706; font-size: 1em; font-weight: 700; margin: 0 0 12px 0;">ğŸ“Œ Biz Kimiz?</h2>
            
            <p style="margin: 0 0 12px 0; color: #4b5563; font-size: 0.95em; line-height: 1.6;">
                <strong>Kolay Bul Ekspres</strong>, AliExpress'teki binlerce Ã¼rÃ¼nÃ¼ kataloglayan ve TÃ¼rk kullanÄ±cÄ±lar iÃ§in arama sÃ¼recini kolaylaÅŸtÄ±ran baÄŸÄ±msÄ±z bir platformdur. HiÃ§bir resmÃ® baÄŸlantÄ±mÄ±z yok, sadece kullanÄ±cÄ±larÄ±mÄ±zÄ±n zamanÄ±nÄ± tasarruf etmek istiyoruz.
            </p>
            
            <p style="margin: 0 0 12px 0; color: #4b5563; font-size: 0.95em; line-height: 1.6;">
                <strong>ğŸ’¡ Neden Buradan Gitmelisiz?</strong> AliExpress'i ziyaret etmek istediÄŸinizde, Ã¼rÃ¼n bulmak dakikalar alabilir. Biz Ã¼rÃ¼nleri Ã¶nceden taradÄ±k, fiyatlarÄ± ve kargo bilgilerini gÃ¼ncelledik. AradÄ±ÄŸÄ±nÄ±z ÅŸeyi saniyeler iÃ§inde bulun.
            </p>
            
            <p style="margin: 0; color: #4b5563; font-size: 0.95em; line-height: 1.6;">
                <strong>ğŸ¤ Bizim KarÄ±mÄ±z Nedir?</strong> AliExpress'in affiliate programÄ± Ã¼zerinden kÃ¼Ã§Ã¼k bir komisyon kazanÄ±yoruz. <u>Sizin Ã¶dediÄŸiniz fiyat deÄŸiÅŸmiyor</u> - aynÄ± fiyattan alÄ±yorsunuz. Sadece siz satÄ±n aldÄ±ÄŸÄ±nÄ±zda, AliExpress bize ufak bir komisyon Ã¶dÃ¼yor. Bu da paranÄ±n ufak bir kÄ±smÄ± da olsa Ã¼lkede kalmasÄ± anlamÄ±na geliyor.
            </p>
        </div>
    </div>
    
    <style>
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }
    </style>
    
    <script>
        document.getElementById('toggleAboutBtn').addEventListener('click', function() {
            const section = document.getElementById('aboutSection');
            const icon = document.getElementById('toggleIcon');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                section.style.animation = 'slideDown 0.3s ease-out';
                icon.style.transform = 'rotate(180deg)';
            } else {
                section.style.animation = 'slideUp 0.3s ease-out';
                setTimeout(function() {
                    section.style.display = 'none';
                }, 300);
                icon.style.transform = 'rotate(0deg)';
            }
        });
    </script>

    <style>
        .product-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            align-items: stretch;
        }
        .product-row-scrollable {
            display: flex;
            overflow-x: auto;
            gap: 6px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 12px;
            padding: 0 8px 8px 8px;
            width: 100%;
        }
        .product-row-scrollable::-webkit-scrollbar {
            height: 6px;
        }
        .product-row-scrollable::-webkit-scrollbar-thumb {
            background: #6366f1;
            border-radius: 3px;
        }
        .product-link {
            display: flex;
            width: calc(50% - 12px);
            min-width: 280px;
            max-width: 420px;
            text-decoration: none;
            color: inherit;
        }
        .product {
            width: 100%;
            height: 100%;
        }
        .product-body {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            align-items: center;
        }
        .product-media {
            width: calc(100% + 24px);
            margin-left: -12px;
            margin-right: -12px;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }
        .product-media img {
            max-width: 100%;
            width: 100%;
        }
        .product-text {
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            min-height: auto;
            max-height: none;
        }
        .shipping-line {
            min-height: 18px;
        }
        .product-title {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-weight: 600;
            font-size: 0.6em;
            line-height: 1.2;
        }
        .product-desc {
            flex: 1;
            display: flex;
            align-items: flex-start;
            overflow: hidden;
            font-size: 0.5em;
            line-height: 1.25;
            word-wrap: break-word;
            white-space: normal;
        }
        @media (max-width: 768px) {
            .product-row {
                display: block;
            }
            .product-row-scrollable {
                display: flex;
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                gap: 6px;
                padding-bottom: 8px;
                margin-bottom: 12px;
            }
            .product-link {
                flex: 0 0 auto;
                min-width: 130px;
                max-width: 165px;
                scroll-snap-align: start;
            }
            .product {
                min-height: 0;
                padding: 3px 4px 4px 4px !important;
                font-size: 0.95em;
            }
            .product-media {
                margin-left: -4px;
                margin-right: -4px;
                margin-bottom: 4px !important;
                overflow: hidden;
                width: calc(100% + 8px);
                height: 100px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .product img {
                height: auto !important;
                max-height: 100px !important;
                width: 100% !important;
                object-fit: contain !important;
            }
            .product .slider-img {
                height: auto !important;
                max-height: 100px !important;
                width: 100% !important;
                object-fit: contain !important;
            }
            .product-text {
                flex: 1;
                min-height: auto;
                max-height: none;
                display: flex;
                flex-direction: column;
            }
            .product-desc {
                flex: 1;
                font-size: 0.45em;
                line-height: 1.2;
                word-wrap: break-word;
                white-space: normal;
            }
            .product-title {
                font-size: 0.55em;
                line-height: 1.15;
            }
            .price-total {
                font-size: 0.7em !important;
            }
            .shipping-line {
                min-height: 14px;
            }
            .stores {
                padding-top: 4px !important;
            }
            .store {
                padding: 4px 4px 4px 4px !important;
                margin-bottom: 4px !important;
            }
            .store a {
                min-height: 28px !important;
                font-size: 0.7em !important;
            }
            .store div {
                line-height: 1.2;
            }
        }
    </style>
    
    <!-- Sticky Arama Formu -->
    <div class="sticky-search" style="position:sticky; top:0; z-index:100; background:#f8faff; padding-top:8px; padding-bottom:8px; box-shadow:0 2px 8px rgba(0,0,0,0.03);">
        <form method="get" action="{% url 'anasayfa' %}" style="max-width: 500px; margin: 0 auto 20px auto;">
            <div style="display: flex; gap: 8px; align-items: center;">
                <input id="searchInput" type="text" name="q" value="{{ search_query }}" placeholder="ÃœrÃ¼n ara... (Ã¶rn: klavye, mouse)" style="flex: 1; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1em; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#6366f1'" onblur="this.style.borderColor='#e5e7eb'" />
                <button type="submit" style="background: #6366f1; color: #fff; border: none; border-radius: 8px; padding: 12px 24px; font-size: 1em; font-weight: 600; cursor: pointer; transition: background 0.2s; white-space: nowrap;" onmouseover="this.style.background='#4f46e5'" onmouseout="this.style.background='#6366f1'">Ara</button>
            </div>
        </form>
    </div>
    {% if search_query %}
    <div style="display: flex; justify-content: center; margin-bottom: 12px;">
        <a href="{% url 'anasayfa' %}" style="background: #ef4444; color: #fff; border-radius: 8px; padding: 10px 32px; font-size: 1.2em; font-weight: 700; text-decoration: none; display: inline-block; box-shadow: 0 2px 8px rgba(0,0,0,0.08); letter-spacing: 1px;">âœ• Temizle</a>
    </div>
    {% endif %}
    {% if search_query %}
    <div style="text-align: center; margin-bottom: 16px; color: #6366f1; font-weight: 600;">"{{ search_query }}" iÃ§in {{ urunler|length }} sonuÃ§ bulundu</div>
    {% endif %}
    
    <!-- ÃœrÃ¼n Resim Carousel -->
    <div class="carousel-wrapper" style="overflow: hidden; margin: 0 0 20px 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 16px 0; border-radius: 12px;">
        <div class="carousel-container" id="productCarousel" style="display: flex; will-change: transform;">
            {% for urun in urunler %}
            <a href="{% url 'urun_affiliate_redirect' urun.id %}" target="_blank" class="carousel-item" style="flex: 0 0 auto; margin: 0 8px; text-decoration: none; cursor: pointer;" data-urun-id="{{ urun.id }}">
                <div class="carousel-circle" style="width: 80px; height: 80px; border-radius: 50%; overflow: hidden; border: 3px solid #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.15); background: #fff; transition: transform 0.2s, box-shadow 0.2s;">
                    {% if urun.resim_url %}
                    <img src="{{ urun.resim_url }}" alt="{{ urun.isim }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% elif urun.resimler.all|length > 0 %}
                    <img src="{{ urun.resimler.all.0.resim.url }}" alt="{{ urun.isim }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% elif urun.resim %}
                    <img src="{{ urun.resim.url }}" alt="{{ urun.isim }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; font-size: 0.7em; text-align: center; padding: 4px;">{{ urun.isim|truncatewords:2 }}</div>
                    {% endif %}
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    <style>
        .carousel-item:hover .carousel-circle {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }
        .carousel-container:hover {
            animation-play-state: paused !important;
        }
        @media (max-width: 768px) {
            .carousel-item {
                margin: 0 4px !important;
            }
            .carousel-circle {
                width: 60px !important;
                height: 60px !important;
                border: 2px solid #fff !important;
            }
            .carousel-wrapper {
                padding: 12px 0 !important;
            }
        }
    </style>
    <script>
    (function() {
        const carousel = document.getElementById('productCarousel');
        const wrapper = carousel.parentElement;
        const items = Array.from(carousel.children);
        
        // Orijinal iÃ§eriÄŸi sakla ve karÄ±ÅŸtÄ±r
        const originalItems = Array.from(carousel.children);
        
        // Fisher-Yates shuffle algoritmasÄ±
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        let animationId = null;
        let translateX = 0;
        
        function initCarousel() {
            // Temizle ve karÄ±ÅŸtÄ±r
            carousel.innerHTML = '';
            const shuffledItems = shuffleArray(originalItems);
            shuffledItems.forEach(item => carousel.appendChild(item.cloneNode(true)));
            translateX = 0;
            
            // Tek bir item'Ä±n geniÅŸliÄŸini hesapla
            const firstItem = carousel.children[0];
            if (!firstItem) return;
            
            const itemWidth = firstItem.offsetWidth;
            const itemMargin = parseInt(window.getComputedStyle(firstItem).marginLeft) + 
                              parseInt(window.getComputedStyle(firstItem).marginRight);
            const totalItemWidth = itemWidth + itemMargin;
            
            // Container ve wrapper geniÅŸliÄŸi
            const wrapperWidth = wrapper.offsetWidth;
            const contentWidth = totalItemWidth * shuffledItems.length;
            
            // EkranÄ± doldurmak iÃ§in kaÃ§ kopya gerekli? (minimum 3 ekran dolusu)
            const copies = Math.ceil((wrapperWidth * 3) / contentWidth) + 2;
            
            // KopyalarÄ± ekle (karÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ listeyi tekrarla)
            const currentHTML = carousel.innerHTML;
            for (let i = 0; i < copies; i++) {
                carousel.innerHTML += currentHTML;
            }
            
            // Animasyon hÄ±zÄ± (piksel/saniye)
            const speed = 30; // Daha yavaÅŸ ve dÃ¼zgÃ¼n
            const distance = contentWidth;
            
            // Animasyonu baÅŸlat
            let lastTime = performance.now();
            
            function animate(currentTime) {
                const deltaTime = (currentTime - lastTime) / 1000;
                lastTime = currentTime;
                
                translateX -= speed * deltaTime;
                
                // Bir set tamamlandÄ±ÄŸÄ±nda sÄ±fÄ±rla
                if (Math.abs(translateX) >= distance) {
                    translateX = translateX % distance;
                }
                
                carousel.style.transform = `translateX(${translateX}px)`;
                animationId = requestAnimationFrame(animate);
            }
            
            animationId = requestAnimationFrame(animate);
        }
        
        // Ä°lk yÃ¼kleme
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initCarousel);
        } else {
            initCarousel();
        }
        
        // Ekran boyutu deÄŸiÅŸince yeniden baÅŸlat
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                if (animationId) cancelAnimationFrame(animationId);
                initCarousel();
            }, 250);
        });
        
        // Hover durumunda durdur
        let isPaused = false;
        carousel.addEventListener('mouseenter', function() {
            isPaused = true;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        });
        
        carousel.addEventListener('mouseleave', function() {
            if (!animationId && !isPaused) {
                let lastTime = performance.now();
                const speed = 30;
                const firstItem = carousel.children[0];
                const itemWidth = firstItem.offsetWidth;
                const itemMargin = parseInt(window.getComputedStyle(firstItem).marginLeft) + 
                                  parseInt(window.getComputedStyle(firstItem).marginRight);
                const distance = (itemWidth + itemMargin) * shuffledItems.length;
                
                function animate(currentTime) {
                    const deltaTime = (currentTime - lastTime) / 1000;
                    lastTime = currentTime;
                    translateX -= speed * deltaTime;
                    if (Math.abs(translateX) >= distance) {
                        translateX = translateX % distance;
                    }
                    carousel.style.transform = `translateX(${translateX}px)`;
                    animationId = requestAnimationFrame(animate);
                }
                animationId = requestAnimationFrame(animate);
            }
            isPaused = false;
        });
    })();
    </script>
    
    <div class="product-row">
    {% for urun in urunler %}
        {% if forloop.counter0|divisibleby:15 %}
            {% if not forloop.first %}</div>{% endif %}
            <div class="product-row-scrollable">
        {% endif %}
        <a class="product-link" href="{% url 'urun_affiliate_redirect' urun.id %}" target="_blank">
        <div class="product" style="min-height: 280px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; background: #fff; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 8px; padding: 8px 12px 12px 12px; transition: box-shadow 0.2s; justify-content: flex-start;">
            <div class="product-body">
            {% if urun.resim_url %}
                <div class="product-media">
                    <img src="{{ urun.resim_url }}" alt="{{ urun.isim }}" style="width:100%; height:240px; margin-bottom:14px; display:block; border-radius:8px; box-shadow:0 6px 16px rgba(0,0,0,0.12); object-fit:contain; background:#ffffff;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                    <div style="width:100%; height:240px; margin-bottom:14px; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:8px; display:none; align-items:center; justify-content:center; color:#fff; font-size:0.9em; font-weight:600; text-align:center; padding:14px; box-shadow:0 6px 16px rgba(0,0,0,0.12);">{{ urun.isim|truncatewords:3 }}</div>
                </div>
            {% elif urun.resimler.all|length > 0 %}
                <div class="slider product-media" style="position:relative; margin-bottom:14px;">
                    <img src="{{ urun.resimler.all.0.resim.url }}" alt="{{ urun.isim }}" class="slider-img" style="width:100%; max-height:200px; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.07); object-fit:contain; background:#ffffff;" />
                    {% if urun.resimler.all|length > 1 %}
                        <button class="slider-prev" style="position:absolute; left:0; top:50%; transform:translateY(-50%); background:#6366f1; color:#fff; border:none; border-radius:50%; width:32px; height:32px; font-size:1.2em; cursor:pointer;">&#8592;</button>
                        <button class="slider-next" style="position:absolute; right:0; top:50%; transform:translateY(-50%); background:#6366f1; color:#fff; border:none; border-radius:50%; width:32px; height:32px; font-size:1.2em; cursor:pointer;">&#8594;</button>
                    {% endif %}
                    <script>
                        (function() {
                            var slider = document.currentScript.parentElement;
                            var images = [
                                {% for resim in urun.resimler.all %}'{{ resim.resim.url }}',{% endfor %}
                            ];
                            var img = slider.querySelector('.slider-img');
                            var prev = slider.querySelector('.slider-prev');
                            var next = slider.querySelector('.slider-next');
                            var idx = 0;
                            if (prev && next) {
                                prev.onclick = function() {
                                    idx = (idx - 1 + images.length) % images.length;
                                    img.src = images[idx];
                                };
                                next.onclick = function() {
                                    idx = (idx + 1) % images.length;
                                    img.src = images[idx];
                                };
                            }
                        })();
                    </script>
                </div>
            {% elif urun.resim %}
                <img src="{{ urun.resim.url }}" alt="{{ urun.isim }}" class="product-media" style="max-height:200px; margin-bottom:14px; display:block; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.07); object-fit:contain; background:#ffffff;" />
            {% else %}
                <div class="product-media" style="height:200px; margin-bottom:14px; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:8px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:1.1em; font-weight:600; text-align:center; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">{{ urun.isim|truncatewords:3 }}</div>
            {% endif %}

            <div class="product-text">
                {% if search_query and urun.urun_kodu %}
                <div style="text-align:center; font-size:0.78em; color:#a0aec0; font-weight:500; margin:6px 0 4px 0; letter-spacing:1px;">{{ urun.urun_kodu }}</div>
                {% endif %}

                {% if urun.aciklama and urun.aciklama != 'CSV ile eklendi' %}
                <div class="product-title" style="text-align:center; font-weight:600; margin-bottom:6px; color:#1f2937; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; width:100%;">{{ urun.isim }}</div>
                <div class="product-desc" style="text-align:center; font-weight:600; color:#4b5563; margin-bottom:10px;">{{ urun.aciklama }}</div>
                {% else %}
                <div class="product-title" style="text-align:center; font-weight:600; margin-bottom:6px; color:#1f2937; word-break:break-word;">{{ urun.isim }}</div>
                {% endif %}
            </div>
            </div>
            <div class="stores" style="flex-direction:column; width:100%; padding-top:6px; margin-top:auto;">
                {% for fiyat in urun.fiyatlar.all %}
                <div class="store" style="margin-bottom:6px; background:#f6f8ff; border-radius:4px; padding:6px 4px 4px 4px; box-shadow:0 1px 4px rgba(60,100,200,0.04); text-align:center;">
                    
                    <!-- GÃ¶nderim Bilgisi (Ãœstte) -->
                    <div style="font-size:0.72em; margin-bottom:6px; padding-bottom:4px; border-bottom:1px solid #e5e7eb;">
                        <span style="color:#6b7280;">ğŸ“ {{ fiyat.gonderim_yerinden }}'den gÃ¶nderiliyor</span>
                    </div>
                    
                    <!-- Fiyat Bilgileri -->
                    <div style="margin-bottom:4px;">
                        <div style="color:#6366f1; font-size:0.78em; font-weight:600; white-space:nowrap;">
                            ÃœrÃ¼n: {{ fiyat.fiyat }} {% if fiyat.para_birimi == 'TL' %}â‚º{% else %}${% endif %}
                        </div>
                        {% if fiyat.gonderim_ucreti > 0 %}
                        <div class="shipping-line" style="color:#f59e0b; font-size:0.68em; font-weight:500;">
                            + Kargo: {{ fiyat.gonderim_ucreti }} {% if fiyat.para_birimi == 'TL' %}â‚º{% else %}${% endif %}
                        </div>
                        {% else %}
                        <div class="shipping-line" style="visibility:hidden; font-size:0.72em; font-weight:500;">-</div>
                        {% endif %}
                        <div class="price-total" style="color:#10b981; font-size:0.8em; font-weight:700; margin-top:2px; padding-top:2px; border-top:1px solid #e5e7eb; white-space:nowrap;">
                            Toplam: {{ fiyat.toplam_fiyat }} {% if fiyat.para_birimi == 'TL' %}â‚º{% else %}${% endif %}
                        </div>
                        
                    </div>
                    
                </div>
                {% endfor %}
            </div>
        </div>
        </a>
        {% if forloop.last %}</div>{% endif %}
    {% endfor %}
    </div>
</div>
<div style="max-width: 500px; margin: 40px auto 0 auto; padding: 0 10px;">
    <button id="yorumAcBtn" style="width:100%; background:#6366f1; color:#fff; border:none; border-radius:8px; padding:14px 0; font-size:1.1em; font-weight:700; cursor:pointer; margin-bottom:10px; min-height:48px;">Yorum BÄ±rakmak Ä°ster misiniz?</button>
    <div id="yorumFormKapsayici" style="display:none; padding: 24px; background: #f9fafb; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
        <h2 style="text-align:center; color:#6366f1; font-size:1.3em; margin-bottom:18px;">Yorum BÄ±rakÄ±n</h2>
        <form method="post" style="display:flex; flex-direction:column; gap:12px;">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" style="background:#6366f1; color:#fff; border:none; border-radius:5px; padding:10px 0; font-size:1.1em; font-weight:600; cursor:pointer;">GÃ¶nder</button>
        </form>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var btn = document.getElementById('yorumAcBtn');
        var formDiv = document.getElementById('yorumFormKapsayici');
        btn.addEventListener('click', function() {
            if (formDiv.style.display === 'none') {
                formDiv.style.display = 'block';
                btn.style.display = 'none';
            }
        });
    });
</script>

<div style="max-width: 600px; margin: 32px auto 0 auto; padding: 0 10px;">
    <h2 style="text-align:center; color:#e08206; font-size:1.15em; margin-bottom:12px;">Son Yorumlar</h2>
    {% for yorum in yorumlar %}
        <div style="background:#fff; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.06); padding:14px 18px; margin-bottom:14px;">
            <div style="font-weight:600; color:#374151;">{{ yorum.isim }}</div>
            <div style="color:#444; margin:6px 0 2px 0;">{{ yorum.yorum }}</div>
            <div style="font-size:0.92em; color:#888; text-align:right;">{{ yorum.eklenme_tarihi|date:"d.m.Y H:i" }}</div>
        </div>
    {% empty %}
        <div style="text-align:center; color:#888;">HenÃ¼z yorum yok.</div>
    {% endfor %}
</div>
<!-- YukarÄ± Ã‡Ä±k Butonu ve scripti block content'in sonunda -->
<button id="scrollTopBtn" title="YukarÄ± Ã‡Ä±k" style="display:none; position:fixed; bottom:32px; right:24px; z-index:9999; background:#6366f1; color:#fff; border:none; border-radius:50%; width:48px; height:48px; font-size:2em; box-shadow:0 2px 8px rgba(0,0,0,0.12); cursor:pointer; transition:background 0.2s;">
    â†‘
</button>
<script>
// YukarÄ± Ã‡Ä±k butonunu gÃ¶ster/gizle
window.addEventListener('scroll', function() {
    var btn = document.getElementById('scrollTopBtn');
    if (window.scrollY > 200) {
        btn.style.display = 'block';
    } else {
        btn.style.display = 'none';
    }
});
// TÄ±klanÄ±nca yukarÄ± animasyonlu kaydÄ±r
document.getElementById('scrollTopBtn').onclick = function() {
    window.scrollTo({top:0, behavior:'smooth'});
};
</script>
{% endblock %}