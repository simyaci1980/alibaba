    
{% extends 'urunler/base.html' %}

{% block title %}Ana Sayfa | KOLAY BUL EKSPRES{% endblock %}

{% block content %}
<div class="container" style="padding: 0 8px;">
    <h1 style="text-align:center; font-size:1.2em; font-weight:800; color:#e6be10; letter-spacing:0.5px; margin:12px 0 16px 0;">Sƒ∞Zƒ∞ UYGUN √úR√úNLERLE BULU≈ûTURUYORUZ </h1>

    <style>
        .product-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            align-items: stretch;
        }
        .product-link {
            display: flex;
            width: calc(50% - 12px);
            min-width: 280px;
            max-width: 420px;
            text-decoration: none;
            color: inherit;
        }
        .product {
            width: 100%;
            height: 100%;
        }
        .product-body {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            align-items: center;
        }
        .product-media {
            width: calc(100% + 24px);
            margin-left: -12px;
            margin-right: -12px;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }
        .product-media img {
            max-width: 100%;
            width: 100%;
        }
        .product-text {
            width: 100%;
            min-height: 56px;
            max-height: 56px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .shipping-line {
            min-height: 18px;
        }
        .product-title {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .product-desc {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-size: 0.9em;
            line-height: 1.3;
        }
        @media (max-width: 768px) {
            .product-row {
                flex-wrap: wrap;
                overflow-x: visible;
                scroll-snap-type: none;
                justify-content: center;
                gap: 8px;
                padding-bottom: 0;
            }
            .product-link {
                flex: 0 0 calc(50% - 8px);
                min-width: 150px;
                max-width: 190px;
            }
            .product {
                min-height: 0;
                padding: 6px 8px 8px 8px !important;
            }
            .product-media {
                margin-left: -10px;
                margin-right: -10px;
            }
            .product img {
                height: 140px !important;
                max-width: 100% !important;
            }
            .product .slider-img {
                max-height: 140px !important;
            }
            .product-text {
                max-height: 52px;
                display: flex;
                flex-direction: column;
            }
            .product-desc {
                -webkit-line-clamp: 2;
                font-size: 0.75em;
            }
            .price-total {
                font-size: 0.78em !important;
            }
            .shipping-line {
                min-height: 16px;
            }
            .stores {
                padding-top: 4px !important;
            }
            .store {
                padding: 4px 4px 4px 4px !important;
                margin-bottom: 4px !important;
            }
            .store a {
                min-height: 28px !important;
                font-size: 0.7em !important;
            }
            .store div {
                line-height: 1.2;
            }
        }
    </style>
    
    <!-- Sticky Arama Formu -->
    <div class="sticky-search" style="position:sticky; top:0; z-index:100; background:#f8faff; padding-top:8px; padding-bottom:8px; box-shadow:0 2px 8px rgba(0,0,0,0.03);">
        <form method="get" action="{% url 'anasayfa' %}" style="max-width: 500px; margin: 0 auto 20px auto;">
            <div style="display: flex; gap: 8px; align-items: center;">
                <input id="searchInput" type="text" name="q" value="{{ search_query }}" placeholder="√úr√ºn ara... (√∂rn: klavye, mouse)" style="flex: 1; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1em; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#6366f1'" onblur="this.style.borderColor='#e5e7eb'" />
                <button type="submit" style="background: #6366f1; color: #fff; border: none; border-radius: 8px; padding: 12px 24px; font-size: 1em; font-weight: 600; cursor: pointer; transition: background 0.2s; white-space: nowrap;" onmouseover="this.style.background='#4f46e5'" onmouseout="this.style.background='#6366f1'">Ara</button>
            </div>
        </form>
    </div>
    {% if search_query %}
    <div style="display: flex; justify-content: center; margin-bottom: 12px;">
        <a href="{% url 'anasayfa' %}" style="background: #ef4444; color: #fff; border-radius: 8px; padding: 10px 32px; font-size: 1.2em; font-weight: 700; text-decoration: none; display: inline-block; box-shadow: 0 2px 8px rgba(0,0,0,0.08); letter-spacing: 1px;">‚úï Temizle</a>
    </div>
    {% endif %}
    {% if search_query %}
    <div style="text-align: center; margin-bottom: 16px; color: #6366f1; font-weight: 600;">"{{ search_query }}" i√ßin {{ urunler|length }} sonu√ß bulundu</div>
    {% endif %}
    
    <div class="product-row">
    {% for urun in urunler %}
        <a class="product-link" href="{% url 'urun_affiliate_redirect' urun.id %}" target="_blank">
        <div class="product" style="min-height: 280px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; background: #fff; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 8px; padding: 8px 12px 12px 12px; transition: box-shadow 0.2s; justify-content: flex-start;">
            <div class="product-body">
            {% if urun.resim_url %}
                <div class="product-media">
                    <img src="{{ urun.resim_url }}" alt="{{ urun.isim }}" style="width:100%; height:240px; margin-bottom:14px; display:block; border-radius:8px; box-shadow:0 6px 16px rgba(0,0,0,0.12); object-fit:contain; background:#ffffff;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                    <div style="width:100%; height:240px; margin-bottom:14px; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:8px; display:none; align-items:center; justify-content:center; color:#fff; font-size:0.9em; font-weight:600; text-align:center; padding:14px; box-shadow:0 6px 16px rgba(0,0,0,0.12);">{{ urun.isim|truncatewords:3 }}</div>
                </div>
            {% elif urun.resimler.all|length > 0 %}
                <div class="slider product-media" style="position:relative; margin-bottom:14px;">
                    <img src="{{ urun.resimler.all.0.resim.url }}" alt="{{ urun.isim }}" class="slider-img" style="width:100%; max-height:200px; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.07); object-fit:contain; background:#ffffff;" />
                    {% if urun.resimler.all|length > 1 %}
                        <button class="slider-prev" style="position:absolute; left:0; top:50%; transform:translateY(-50%); background:#6366f1; color:#fff; border:none; border-radius:50%; width:32px; height:32px; font-size:1.2em; cursor:pointer;">&#8592;</button>
                        <button class="slider-next" style="position:absolute; right:0; top:50%; transform:translateY(-50%); background:#6366f1; color:#fff; border:none; border-radius:50%; width:32px; height:32px; font-size:1.2em; cursor:pointer;">&#8594;</button>
                    {% endif %}
                    <script>
                        (function() {
                            var slider = document.currentScript.parentElement;
                            var images = [
                                {% for resim in urun.resimler.all %}'{{ resim.resim.url }}',{% endfor %}
                            ];
                            var img = slider.querySelector('.slider-img');
                            var prev = slider.querySelector('.slider-prev');
                            var next = slider.querySelector('.slider-next');
                            var idx = 0;
                            if (prev && next) {
                                prev.onclick = function() {
                                    idx = (idx - 1 + images.length) % images.length;
                                    img.src = images[idx];
                                };
                                next.onclick = function() {
                                    idx = (idx + 1) % images.length;
                                    img.src = images[idx];
                                };
                            }
                        })();
                    </script>
                </div>
            {% elif urun.resim %}
                <img src="{{ urun.resim.url }}" alt="{{ urun.isim }}" class="product-media" style="max-height:200px; margin-bottom:14px; display:block; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.07); object-fit:contain; background:#ffffff;" />
            {% else %}
                <div class="product-media" style="height:200px; margin-bottom:14px; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:8px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:1.1em; font-weight:600; text-align:center; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">{{ urun.isim|truncatewords:3 }}</div>
            {% endif %}

            <div class="product-text">
                {% if search_query and urun.urun_kodu %}
                <div style="text-align:center; font-size:0.78em; color:#a0aec0; font-weight:500; margin:6px 0 4px 0; letter-spacing:1px;">{{ urun.urun_kodu }}</div>
                {% endif %}

                {% if urun.aciklama and urun.aciklama != 'CSV ile eklendi' %}
                <div class="product-title" style="text-align:center; font-weight:600; font-size:0.82em; margin-bottom:6px; line-height:1.25; color:#1f2937; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; width:100%;">{{ urun.isim }}</div>
                <div class="product-desc" style="text-align:center; font-size:0.9em; font-weight:600; color:#4b5563; margin-bottom:10px; line-height:1.45;">{{ urun.aciklama }}</div>
                {% else %}
                <div class="product-title" style="text-align:center; font-weight:600; font-size:0.88em; margin-bottom:6px; line-height:1.35; color:#1f2937; word-break:break-word;">{{ urun.isim }}</div>
                {% endif %}
            </div>
            </div>
            <div class="stores" style="flex-direction:column; width:100%; padding-top:6px; margin-top:auto;">
                {% for fiyat in urun.fiyatlar.all %}
                <div class="store" style="margin-bottom:6px; background:#f6f8ff; border-radius:4px; padding:6px 4px 4px 4px; box-shadow:0 1px 4px rgba(60,100,200,0.04); text-align:center;">
                    
                    <!-- G√∂nderim Bilgisi (√ústte) -->
                    <div style="font-size:0.72em; margin-bottom:6px; padding-bottom:4px; border-bottom:1px solid #e5e7eb;">
                        <span style="color:#6b7280;">üìç {{ fiyat.gonderim_yerinden }}'den g√∂nderiliyor</span>
                    </div>
                    
                    <!-- Fiyat Bilgileri -->
                    <div style="margin-bottom:4px;">
                        <div style="color:#6366f1; font-size:0.78em; font-weight:600; white-space:nowrap;">
                            √úr√ºn: {{ fiyat.fiyat }} {% if fiyat.para_birimi == 'TL' %}‚Ç∫{% else %}${% endif %}
                        </div>
                        {% if fiyat.gonderim_ucreti > 0 %}
                        <div class="shipping-line" style="color:#f59e0b; font-size:0.68em; font-weight:500;">
                            + Kargo: {{ fiyat.gonderim_ucreti }} {% if fiyat.para_birimi == 'TL' %}‚Ç∫{% else %}${% endif %}
                        </div>
                        {% else %}
                        <div class="shipping-line" style="visibility:hidden; font-size:0.72em; font-weight:500;">-</div>
                        {% endif %}
                        <div class="price-total" style="color:#10b981; font-size:0.8em; font-weight:700; margin-top:2px; padding-top:2px; border-top:1px solid #e5e7eb; white-space:nowrap;">
                            Toplam: {{ fiyat.toplam_fiyat }} {% if fiyat.para_birimi == 'TL' %}‚Ç∫{% else %}${% endif %}
                        </div>
                        
                    </div>
                    
                </div>
                {% endfor %}
            </div>
        </div>
        </a>
    {% endfor %}
    </div>
</div>
<div style="max-width: 500px; margin: 40px auto 0 auto; padding: 0 10px;">
    <button id="yorumAcBtn" style="width:100%; background:#6366f1; color:#fff; border:none; border-radius:8px; padding:14px 0; font-size:1.1em; font-weight:700; cursor:pointer; margin-bottom:10px; min-height:48px;">Yorum Bƒ±rakmak ƒ∞ster misiniz?</button>
    <div id="yorumFormKapsayici" style="display:none; padding: 24px; background: #f9fafb; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
        <h2 style="text-align:center; color:#6366f1; font-size:1.3em; margin-bottom:18px;">Yorum Bƒ±rakƒ±n</h2>
        <form method="post" style="display:flex; flex-direction:column; gap:12px;">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" style="background:#6366f1; color:#fff; border:none; border-radius:5px; padding:10px 0; font-size:1.1em; font-weight:600; cursor:pointer;">G√∂nder</button>
        </form>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var btn = document.getElementById('yorumAcBtn');
        var formDiv = document.getElementById('yorumFormKapsayici');
        btn.addEventListener('click', function() {
            if (formDiv.style.display === 'none') {
                formDiv.style.display = 'block';
                btn.style.display = 'none';
            }
        });
    });
</script>

<div style="max-width: 600px; margin: 32px auto 0 auto; padding: 0 10px;">
    <h2 style="text-align:center; color:#e08206; font-size:1.15em; margin-bottom:12px;">Son Yorumlar</h2>
    {% for yorum in yorumlar %}
        <div style="background:#fff; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.06); padding:14px 18px; margin-bottom:14px;">
            <div style="font-weight:600; color:#374151;">{{ yorum.isim }}</div>
            <div style="color:#444; margin:6px 0 2px 0;">{{ yorum.yorum }}</div>
            <div style="font-size:0.92em; color:#888; text-align:right;">{{ yorum.eklenme_tarihi|date:"d.m.Y H:i" }}</div>
        </div>
    {% empty %}
        <div style="text-align:center; color:#888;">Hen√ºz yorum yok.</div>
    {% endfor %}
</div>
<!-- Yukarƒ± √áƒ±k Butonu ve scripti block content'in sonunda -->
<button id="scrollTopBtn" title="Yukarƒ± √áƒ±k" style="display:none; position:fixed; bottom:32px; right:24px; z-index:9999; background:#6366f1; color:#fff; border:none; border-radius:50%; width:48px; height:48px; font-size:2em; box-shadow:0 2px 8px rgba(0,0,0,0.12); cursor:pointer; transition:background 0.2s;">
    ‚Üë
</button>
<script>
// Yukarƒ± √áƒ±k butonunu g√∂ster/gizle
window.addEventListener('scroll', function() {
    var btn = document.getElementById('scrollTopBtn');
    if (window.scrollY > 200) {
        btn.style.display = 'block';
    } else {
        btn.style.display = 'none';
    }
});
// Tƒ±klanƒ±nca yukarƒ± animasyonlu kaydƒ±r
document.getElementById('scrollTopBtn').onclick = function() {
    window.scrollTo({top:0, behavior:'smooth'});
};
</script>
{% endblock %}