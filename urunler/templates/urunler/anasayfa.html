{% extends 'urunler/base.html' %}

{% block title %}Ana Sayfa | KOLAY BUL EKSPRES{% endblock %}

{% block content %}
<div class="container">
    <h1 style="text-align:center; font-size:2.1em; font-weight:800; color:#e6be10; letter-spacing:1px; margin-bottom:28px;">SİZİ UYGUN ÜRÜNLERLE BULUŞTURUYORUZ </h1>
    <div style="display: flex; flex-wrap: wrap; gap: 24px; justify-content: center;">
    {% for urun in urunler %}
        <div class="product" style="width: 320px; min-height: 340px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 18px; padding: 18px 10px 16px 10px; transition: box-shadow 0.2s;">
            <div class="product-title" style="text-align:center; font-weight:600; font-size:1.15em; margin-bottom:8px;">{{ urun.isim }}</div>
            {% if urun.aciklama %}
            <div class="product-desc" style="text-align:center; color:#555; font-size:0.98em; margin-bottom:8px; min-height:40px;">{{ urun.aciklama }}</div>
            {% endif %}

            {% if urun.resimler.all|length > 0 %}
                <div class="slider" style="position:relative; width:100%; max-width:400px; margin-bottom:14px;">
                    <img src="{{ urun.resimler.all.0.resim.url }}" alt="{{ urun.isim }}" class="slider-img" style="width:100%; max-height:200px; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.07);" />
                    {% if urun.resimler.all|length > 1 %}
                        <button class="slider-prev" style="position:absolute; left:0; top:50%; transform:translateY(-50%); background:#6366f1; color:#fff; border:none; border-radius:50%; width:32px; height:32px; font-size:1.2em; cursor:pointer;">&#8592;</button>
                        <button class="slider-next" style="position:absolute; right:0; top:50%; transform:translateY(-50%); background:#6366f1; color:#fff; border:none; border-radius:50%; width:32px; height:32px; font-size:1.2em; cursor:pointer;">&#8594;</button>
                    {% endif %}
                    <script>
                        (function() {
                            var slider = document.currentScript.parentElement;
                            var images = [
                                {% for resim in urun.resimler.all %}'{{ resim.resim.url }}',{% endfor %}
                            ];
                            var img = slider.querySelector('.slider-img');
                            var prev = slider.querySelector('.slider-prev');
                            var next = slider.querySelector('.slider-next');
                            var idx = 0;
                            if (prev && next) {
                                prev.onclick = function() {
                                    idx = (idx - 1 + images.length) % images.length;
                                    img.src = images[idx];
                                };
                                next.onclick = function() {
                                    idx = (idx + 1) % images.length;
                                    img.src = images[idx];
                                };
                            }
                        })();
                    </script>
                </div>
            {% elif urun.resim %}
                <img src="{{ urun.resim.url }}" alt="{{ urun.isim }}" style="max-width:400px; max-height:200px; margin-bottom:14px; display:block; margin-left:auto; margin-right:auto; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.07);" />
            {% endif %}
            <div class="stores" style="flex-direction:column; width:100%; margin-top:8px;">
                {% for fiyat in urun.fiyatlar.all %}
                <div class="store" style="margin-bottom:10px; background:#f6f8ff; border-radius:6px; padding:10px 8px 8px 8px; box-shadow:0 1px 4px rgba(60,100,200,0.04); text-align:center;">
                    <div style="font-weight:500; color:#374151; margin-bottom:2px;">{{ fiyat.magaza.isim }}</div>
                    <div style="color:#6366f1; font-size:1.08em; font-weight:600; margin-bottom:4px;">Fiyat: {{ fiyat.fiyat }} TL</div>
                    <a href="{{ fiyat.affiliate_link }}" target="_blank" style="display:inline-block; background:#6366f1; color:#fff; padding:6px 16px; border-radius:4px; text-decoration:none; font-weight:500; font-size:0.98em; transition:background 0.2s;">MAĞAZAYA GİT</a>
                </div>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
    </div>
</div>
<div style="max-width: 500px; margin: 40px auto 0 auto;">
    <button id="yorumAcBtn" style="width:100%; background:#6366f1; color:#fff; border:none; border-radius:8px; padding:12px 0; font-size:1.1em; font-weight:700; cursor:pointer; margin-bottom:10px;">Yorum Bırakmak İster misiniz?</button>
    <div id="yorumFormKapsayici" style="display:none; padding: 24px; background: #f9fafb; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
        <h2 style="text-align:center; color:#6366f1; font-size:1.3em; margin-bottom:18px;">Yorum Bırakın</h2>
        <form method="post" style="display:flex; flex-direction:column; gap:12px;">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" style="background:#6366f1; color:#fff; border:none; border-radius:5px; padding:10px 0; font-size:1.1em; font-weight:600; cursor:pointer;">Gönder</button>
        </form>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var btn = document.getElementById('yorumAcBtn');
        var formDiv = document.getElementById('yorumFormKapsayici');
        btn.addEventListener('click', function() {
            if (formDiv.style.display === 'none') {
                formDiv.style.display = 'block';
                btn.style.display = 'none';
            }
        });
    });
</script>

<div style="max-width: 600px; margin: 32px auto 0 auto;">
    <h2 style="text-align:center; color:#e08206; font-size:1.15em; margin-bottom:12px;">Son Yorumlar</h2>
    {% for yorum in yorumlar %}
        <div style="background:#fff; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.06); padding:14px 18px; margin-bottom:14px;">
            <div style="font-weight:600; color:#374151;">{{ yorum.isim }}</div>
            <div style="color:#444; margin:6px 0 2px 0;">{{ yorum.yorum }}</div>
            <div style="font-size:0.92em; color:#888; text-align:right;">{{ yorum.eklenme_tarihi|date:"d.m.Y H:i" }}</div>
        </div>
    {% empty %}
        <div style="text-align:center; color:#888;">Henüz yorum yok.</div>
    {% endfor %}
</div>
{% endblock %}